:root {
  --uno-colors-primary: theme('colors.primary');
  --uno-colors-background: theme('colors.background');
  --uno-fonts-ui: theme('fontFamily.ui');
  --uno-colors-shadow: theme('colors.shadow');
}
html {
  --at-apply: antialiased;
  --at-apply: 'bg-background c-primary font-ui text-shadow-color-shadow';

  font-family: 'Noto Sans JP', sans-serif;

  text-shadow: 1px 1px 1px var(--uno-colors-shadow);
  background-size: 7px 7px;
  background-image: linear-gradient(to right, var(--uno-colors-shadow) 1px, transparent 1px),
    linear-gradient(to bottom, var(--uno-colors-shadow) 1px, transparent 1px);
}

:where(a):not(.not-underline-hover) {
  --at-apply: 'p-1.5px';
  --at-apply: 'decoration-underline decoration-0.1em decoration-offset-2px';
  --at-apply: 'ease-in-out duration-300ms';
  --at-apply: 'hover:(c-background bg-primary decoration-primary)';
}

/* =========================
   MathML / rehype-katex fixes
   Improve aligned (&=) rendering on Safari / mobile
   ========================= */


/* Ensure inner MathML elements don't force fixed width */
math,
math * {
  max-width: 100%;
  box-sizing: border-box;
  -webkit-transform: none;
  transform: none;
}


/* Some user-agents (Safari) apply transforms/zoom on math tables â€” neutralize */
math mtable {
  -webkit-transform: none;
  transform: none;
}

/* Fallback for classes rehype-katex may emit */
.rehype-katex math,
.rehype-katex .math {
  overflow-x: auto;
  max-width: 100%;
}

/* =========================
   Safari: fix aligned (&=) column alignment for MathML (rehype-katex)
   - force table-like rendering and auto table-layout
   - let first (possibly empty) column shrink
   - center the equals column so &= lines up
   ========================= */
.rehype-katex math mtable,
math mtable {
  display: table !important;
  table-layout: auto !important;
  width: auto !important;
  max-width: 100% !important;
  margin: 0;
  border-collapse: collapse;
}

.rehype-katex math mtr,
math mtr {
  display: table-row !important;
}

.rehype-katex math mtd,
math mtd {
  display: table-cell !important;
  box-sizing: border-box;
  vertical-align: baseline !important;
  padding: 0 0.25rem !important;
  min-width: 0 !important;        /* allow columns to shrink on narrow viewports */
  white-space: nowrap !important; /* keep short tokens unbroken; long parts wrap in later columns */
}

/* make the (often-empty) leading column collapse */
.rehype-katex math mtr > mtd:first-child,
math mtr > mtd:first-child {
  width: 1% !important;
  padding-right: 0.25rem !important;
  white-space: nowrap !important;
}

/* center the equals column so '&=' aligns vertically;
   allow right-side content to wrap when needed */
.rehype-katex math mtr > mtd:nth-child(2),
math mtr > mtd:nth-child(2) {
  text-align: center !important;
  white-space: normal !important;
}

.rehype-katex math mtr > mtd:nth-child(3),
math mtr > mtd:nth-child(3) {
  text-align: left !important;
  white-space: normal !important;
}

/* ensure MathML elements don't get transformed/scaled by Safari */
.rehype-katex math,
math {
  -webkit-transform: none !important;
  transform: none !important;
}

/* Fix: prevent Safari from clipping ordered/unordered list markers */
ol, ul {
  -webkit-padding-start: 1.5rem !important; /* Safari */
  padding-inline-start: 1.5rem !important;
  list-style-position: outside !important;
  margin-inline-start: 0 !important;
}

/* Ensure list items themselves are not clipped by overflow */
ol li, ul li {
  overflow: visible !important;
}

/* If a parent transform/overflow clips markers on Safari, this helps avoid clipping */
ol, ul {
  isolation: isolate;
}

/* =========================
   Mobile-specific fixes: prevent list markers from being clipped on iOS
   ========================= */
@media (max-width: 640px) {
  /* Give list markers enough inset on narrow screens (prevent clipping) */
  ol, ul {
    -webkit-padding-start: max(1.6rem, env(safe-area-inset-left)) !important;
    padding-inline-start: max(1.6rem, env(safe-area-inset-left)) !important;
    list-style-position: outside !important;
  }
}
